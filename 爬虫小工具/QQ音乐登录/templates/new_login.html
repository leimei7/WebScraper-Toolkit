<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QQ扫码登录</title>
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">-->
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
       .qr-code-container {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="qr-code-container">
        <h1 class="mb-4">请使用QQ扫码登录</h1>
        <img id="qrcode" src="" alt="QR Code" class="img-fluid">
    </div>

    <script>
        // 获取二维码
        fetch('http://127.0.0.1:5000/newlogin/qrcode')
           .then(response => response.json())
           .then(data => {
                if (data.qr_code_base64) {
                    document.getElementById('qrcode').src = 'data:image/png;base64,' + data.qr_code_base64;
                    checkLoginStatus();
                } else {
                    alert('获取二维码失败');
                }
            })
           .catch(error => {
                console.error('获取二维码时出错:', error);
                alert('获取二维码时出错，请稍后重试');
            });

        function checkLoginStatus() {
            // 每隔5秒检查一次登录状态
            setInterval(() => {
                fetch('http://127.0.0.1:5000/newlogin/check_status')
                   .then(response => response.json())
                   .then(data => {
                        if (data.success) {
                            alert('登录成功');
                            document.getElementById('qrcode').style.display = 'none';
                        } else if (data.message === '二维码已经失效') {
                            alert('二维码已经失效，请重新获取');
                            document.getElementById('qrcode').style.display = 'none';
                        }
                    })
                   .catch(error => {
                        console.error('检查登录状态时出错:', error);
                    });
            }, 5000);
        }
    </script>

<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>-->
</body>
</html>